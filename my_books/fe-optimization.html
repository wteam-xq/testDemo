<!DOCTYPE html>
<html>
  <head>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>
      《前端性能优化链路》 学习笔记
    </title>
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../markdown.css" />
    <style>
      a:hover {
        text-decoration: none;
      }
      a {
        color: #cb9c64;
      }
      .normal-img {
        width: 100%;
        height: auto;
      }
      .txt {
        margin-left: 20px;
      }
    </style>
  </head>
  <body>
    <div class="main markdown">
      <h1>《前端性能优化链路》 学习</h1>
      <a href="https://time.geekbang.org/course/intro/257" target="_blank">极客时间地址</a>
      <a href="https://mark.show/" target="_blank">MarkShow - 在线PPT，复制 feOptimization 内容</a>
      
      <h2>章节</h2>
      <ul>
        <li>1）静态资源优化</li>
        <li>2）页面渲染架构设计</li>
        <li>3）原生APP优化</li>
        <li>4）服务端和网络优化</li>
        <li>5）研发开发流程优化</li>
        <li>6）全链路质量监控</li>
      </ul>

      <h4>01课程介绍</h4>
      <div>讲师10年前端开发经验， 系统学习前端优化；</div>
      <div>根据讲师内容 + 个人理解，系统整理前端优化链路；</div>

      <h4>02课程综述， 六大部分；</h4>
      <div>静态资源优化</div>
      <div>页面渲染架构设计</div>
      <div>原生APP优化</div>
      <div>原生APP优化</div>
      <div>研发开发流程优化</div>
      <div>全链路质量监控</div>

      <h3>1）静态资源优化：</h3>
      <h4>03图片优化： 图片格式</h4>
      <div>图片格式场景； jpg,png,gif,webp；</div>
      <div>最新格式图片 下一代图片格式 AVIF（AV1 Image File Format）已经来了，此格式比 JPEG 小 50% 左右、比 WebP 小 20% 左右，相关性能跑分见此，目前 Chrome 85、Firefox 77 已支持；</div>

      <h4>04图片优化：加速图片加载</h4>
      <div>压缩图片,<a href="https://tinypng.com/" target="_blank">tinypng</a>, <a href="https://www.npmjs.com/package/imagemin-webpack-plugin" target="_blank">imagemin-webpack-plugin</a></div>
      <div>图片占位符（默认图片）</div>
      <div>压缩图片,低质图片占位符，<a href="https://www.npmjs.com/package/lqip" target="_blank">LQIP</a>, <a href="https://www.npmjs.com/package/sqip" target="_blank">SQIP</a></div>

      <h4>05图片优化：服务器端图片优化</h4>
      <div>图片裁剪：按长边、短边、填充、拉伸等缩放</div>
      <div>图片格式转换： 支持 jpg,png,gif,webp 相互转换，不同图片压缩率等</div>
      <div>图片处理：添加图片水印、高斯模糊、重心处理、裁剪边框等</div>
      <div>AI能力：智能排版、智能鉴黄、智能配色、智能合成、智能抠图等</div>
      <div>业界低成本 - 使用 阿里云图片服务；</div>
      <div>不同业务，使用不同域名</div>

      <h4>06HTML优化</h4>
      <div>骨架屏：页面渲染前呈现用户内容</div>
      <div>压缩合并HTML</div>
      <div>减少HTML嵌套、使用语义化标签 等</div>
      <div>CSS样式内容放页面头部、JS放HTML底部</div>

      <h4>07CSS 优化</h4>
      <div>减少嵌套样式、text-content:-9999px; CSS3动画 等属性少用；</div>
      <div>避免使用通配选择符：body li { font-size: 14px; }</div>
      <div>压缩CSS代码</div>
      <div>体积小于5KB图标使用base64图，大型站点使用字体图标</div>

      <h4>08JS 执行优化</h4>
      <div>requestAnimationFrame 取代 setTimeout, setInterval,考虑兼容性，该API支持情况：(IE 10+)</div>
      <div>压缩JS代码</div>
      <div><a href="https://zhuanlan.zhihu.com/p/38313717" target="_blank">节流、防抖函数</a></div>
      <div>使用CSS动画替代JS动画、数量庞大的表格等使用Canvas画板</div>

      <h4>09JS 缓存优化</h4>
      <div>Cookies 存储体积较小，不同浏览器：3Kb ~ 5Kb</div>
      <div>LocalStorage</div>
      <div>SessionStorage</div>
      <div>IndexedDB(google doc, 石墨文档等);</div>

      <h4>10JS模块化</h4>
      <div>Command JS Node.js 模块化方案</div>
      <div>AMD 前端异步模块定义，实现库：Require.js</div>
      <div>CMD 前端通用模块定义，实现库：Sea.js</div>
      <div>ES6 import, 未来主流方式</div>

      <h4>11减少回流、重绘： </h4>
      <div>谷歌浏览器，开发调试工具， 查看回流、重绘 选项；<a href="https://juejin.cn/book/6844733783166418958/section/6844733783187390477" target="_blank">你不知道的Chrome调试技巧</a></div>
      <div>CSS 使用绝对定位(fixed, absolute),让更新频繁节点脱离文档流</div>
      <div>JS 避免频繁操作DOM，多次DOM节点操作可合并成一个</div>
      <div><a href="https://juejin.cn/post/6953029989306466317#heading-0" target="_blank">避免回流和重绘的必要性</a></div>

      <h4>12DOM 编程优化</h4>
      <div>简化DOM操作, 多次操作合并成一个；</div>
      <div>控制DOM节点数量，参考React，Vue等前端框架虚拟DOM；</div>

      <h4>13压缩工具</h4>
      <div>
        HTML:<a href="https://www.npmjs.com/package/html-minifier" target="_blank">html-minifier</a>, 
        CSS:<a href="https://www.npmjs.com/package/clean-css" target="_blank">clean-css</a>, 
        JS:<a href="https://www.npmjs.com/package/uglify" target="_blank">uglify</a></div>
      <div>在线工具1：<a href="https://www.345tool.com/zh-hans" target="_blank">345tool在线工具</a></div>
      <div>在线工具2：<a href="https://www.baidufe.com/fehelper/index/index.html" target="_blank">FeHelper</a></div>

      <h4>14静态打包工具： </h4>
      <div>压缩、合并 CSS， JS；Combo 方案： domain/xxxx?a.js,b.js</div>
      <div>webpack 代码切割配置, <a href="https://segmentfault.com/a/1190000017066322" target="_blank">webpack4 optimization总结</a></div>

      <h4>15版本号更新策略；</h4>
      <div>eg: 大版本 v1，小版本 v1.2.0, 时间节点（例如年底）收拢版本， 旧版本302重定向到最新版本</div>
      <div>现有较成熟的版本管理机制当属语义化版本号[2]，表现形式为 {主版本}.{次版本}.{补丁版本} - <a href="https://mp.weixin.qq.com/s/zxXod2FyRqg93TkvP_2Bdw" target="_blank">如何打造一款标准的 JS SDK ？</a></div>

      <h4>16常用构建工具：</h4>
      <div>grunt, gulp, webpack， FIS， 以及 讲师着重介绍的 JDF（小众构建工具）</div>
      <div>ES, Vite JS, Rome等; 详细参见 -  <a href="https://risingstars.js.org/2020/zh#section-build" target="_blank">2020年GitHub 明星项目-构建工具</a></div>

      <h4>17webpack打包优化： </h4>
      <div>优化4个小技巧：</div>
      <div>定位大模块、删除无用模块、生产模式公共模块抽离、开发模式DLL & DllReference优化；</div>
      <div><a href="https://segmentfault.com/a/1190000019404454" target="_blank">webpack-打包优化</a></div>

      <h3>2）页面渲染架构设计：</h3>

      <h4>18浏览器渲染过程</h4>
      <div>浏览器渲染过程， 缺少了CDN解析、HTTP握手相关；<a href="https://blog.csdn.net/weixin_42069147/article/details/105599327" target="_blank">浏览器渲染原理和过程</a></div>
      <div>浏览器解析HTML，生成DOM树；</div>
      <div>浏览器解析CSS，生成CSSOM（CSS Object Model）树；</div>
      <div>JS 会通过DOM API（DOM）和 CSSOM API 操作 DOM 树和 CSS Rule 树， 浏览器将DOM树和 CSSOM树 合成渲染树（Render Tree）；</div>
      <div>布局（Layout）: 根据生成的Render Tree进行回流 计算每个节点的几何信息；（位置、大小、字体样式等）</div>
      <div>绘制（painting）: 根据渲染树和回流得到几何信息，得到每个节点绝对像素；</div>
      <div>展示（display）: 将像素发给图形处理器GPU， 展示在页面上；</div>

      <h4>19页面渲染技术架构</h4>
      <div>服务端渲染： 后端同步渲染、同构直出、BigPipe</div>
      <div>
        <span>客户端渲染：</span>
        <ul>
          <li>1）JavaScript渲染，静态化，前后端分离、单页面应用；</li>
          <li>2）Web APP: Angular, React, Vue 等 PWA</li>
          <li>3）原生APP： Android, IOS</li>
          <li>4）Hybrid APP: phoneGap, AppCan 等</li>
          <li>5）跨平台应用: Weex, React Native, Flutter, 小程序等</li>
        </ul>
      </div>
      
      <h4>20后端同步渲染</h4>
      <div>JSP，PHP， ASP 步骤差不多，以JSP为例</div>
      <div>
        <ul>
          <li>步骤1：JSP Servlet映射以.jsp结尾URL，JSP 文件请求时， Servlet容器知道调用哪个Servlet</li>
          <li>步骤2：Servlet 容器检查 Servlet 是否已被编译</li>
          <li>步骤3：如未编译， 容器将JSP代码转换成Servlet代码，进行编译</li>
          <li>步骤4：Servlet容器将 JSP 请求转发到编译完成的 JSP Servlet类</li>
          <li>步骤5：JSP Servlet类 返回并发送给客户端浏览器对应HTML</li>
        </ul>
      </div>
      <div>优点：快速实现业务开发、上线（协作模板引擎：JSmart, Velocity.js）； 缺点：用户需等待HTML完全加载才看到页面（白屏问题），代码耦合严重，前端页面复杂时不方便更新、迭代；</div>

      <h4>21动态页做页面静态化</h4>
      <div>静态化是指动态化网站生成静态HTML页面供用户、搜索引擎更好访问的技术，分成纯静态化和伪静态化两种</div>
      <div>优势：</div>
      <div>
        <ul>
          <li>1）提高访问速度</li>
          <li>2）有利于SEO，搜索引擎更容易收录</li>
          <li>3）更稳定，后端出问题后，因为静态页有缓存不影响用户访问</li>
        </ul>
      </div>
      <div>劣势：</div>
      <div>
        <ul>
          <li>占用服务器硬盘空间</li>
          <li>静态页更新可能产生死链</li>
        </ul>
      </div>

      <h4>22实现前后端分离</h4>
      <div>定义：前后端人员分离，技术栈分离； 后端负责业务功能、提供数据接口，前端负责页面UI、交互逻辑等；</div>
      <div>优势：团队更加专注、提升开发效率、增加代码可维护性</div>
      <div>后端架构：JAVA 、PHP + nginx,使用微服务（dubbo）, 使用某种协议例如JSF 提供不同服务； 前端架构： Angular,React,Vue等前端框架编译后部署 CDN 或 Node Server；</div>
      <div>劣势：前端工作量较多，重前端，需要前端人员较多； 不利于SEO；</div>

      <h4>23单页面应用场景</h4>
      <div>定义： SPA（single-page-Application）, 页面切换浏览器不重新加载，而是通过动态重写当前页；</div>
      <div>优点：</div>
      <div>
        <ul>
          <li>1）页面切换、交互加载速度快；</li>
          <li>2）良好交互体验；</li>
          <li>3）前后端职责分离；</li>
          <li>4）减轻服务器负载；</li>
        </ul>
      </div>
      <div>缺点：</div>
      <div>
        <ul>
          <li>1）开发成本高</li>
          <li>2）首次加载时间长</li>
          <li>3）对SEO不友好 </li>
        </ul>
      </div>

      <h4>24BigPipe</h4>
      <div>定义：页面加载到 pagelet, 加快页面渲染速度。将整个页面拆解成N个 pagelet，各自渲染优化用户体验；</div>
      <div>技术实现：</div>
      <div>
        <ul>
          <li>浏览器向服务器请求页面</li>
          <li>Server 快速返回 pagelet 容器（空DIV）， 与浏览器HTTP保持连接状态</li>
          <li>浏览器分别下载 pageliet，渲染页面</li>
          <li>所有 pageliet 下发完成， 发送 已完成标识位</li>
          <li>浏览器注入HTML，小部分CSS</li>
          <li>接收完所有页面后加载外部 JavaScript</li>
          <li>浏览器执行所有内联 JavaScript</li>
        </ul>
      </div>

      <h4>25同构直出选择</h4>
      <div>同构定义：一套代码既可以在服务端运行，又可以在客户端运行；</div>
      <div>优势：</div>
      <div>
        <ul>
          <li>降低首屏渲染时间</li>
          <li>有理于SEO，爬虫喜欢DOM结构页面</li>
          <li>规避白屏</li>
          <li>代码同构： 上线两版本，利于灾备</li>
        </ul>
      </div>
      <div>实现： next.js, gatsbjs, nuxt.js; express, koa2, egg等；</div>

      <h4>26PWA</h4>
      <div>定义： Progressive Web App 简称 PWA， 使用特定技术和标准模式开发的Web应用；</div>
      <div>优势：</div>
      <div>
        <ul>
          <li>消除Web对网络的依赖，媲美设备原生APP，优化用户体验</li>
          <li>缓存资源，秒开页面</li>
          <li>内容可被搜索引擎收录</li>
          <li>可给用户发送离线消息</li>
        </ul>
      </div>
      <div>实现， 全站改成Https,Service Worker, App Manifest. 浏览器核心API： ServiceWorkerGlobalScope（浏览器支持率：88%）， Web App Manifest(浏览器支持率：83%)</div>

      <h4>27页面渲染：技术方案选择</h4>
      <div>1）存在即合理， 旧项目有历史原因，不可大改； </div>
      <div>2）依赖业务形式； </div>
      <div>3）依赖团队规模； </div>
      <div>4）依赖技术水平；</div>
      <div>5）没有银弹。</div>

      <h4>28页面加载：加载策略</h4>
      <div>懒加载：延迟加载特定元素：图片、JS/CSS、JS特定函数； 实现思路： 监听滚动条，如懒加载元素(有data-lazy属性) 且可见，其 src 由空变成真实值。</div>
      <div>预加载：让浏览器预先加载某些资源，如图片、JS/CSS/模板，这些资源将来才使用； 例如： 一级页面预先加载二级页面资源，加快二级页面打开速度；实现：preload, prefetch, preconnect。</div>
      <div>预渲染：大型项目，提前加载后续组件；</div>
      <div>按需加载：常规按需加载（原生JS，JQuery），不同APP按需加载（判断是否在微信APP觉得是否加载对应JS-SDK脚本）， 不同设备按需加载（PC端和H5端样式文件），不同分辨率按需加载（<a href="https://www.runoob.com/cssref/css3-pr-mediaquery.html" target="_blank">CSS Media Query</a>）</div>
      <div>楼层式加载： 楼层页加载、缓存对应数据；</div>

    </div>
  </body>
</html>
